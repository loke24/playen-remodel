angular.module("playven").controller("controller",["$rootScope","$scope","$mdDialog","$state","$location","$window","authService","storageService","authToken","Toaster",function($rootScope,$scope,$mdDialog,$state,$location,$window,authService,storageService,authToken,Toaster){$scope.games=["tennis","soccer","badminton","volleyball","football"],$scope.venues=["jolarpet","tirupattur","vaniyambadi","ambur"],$scope.timings=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00"],$scope.hours=["30 min","60 min","1 hours","2 hours","3 hours"],$scope.game=$scope.games[0],$scope.venue=$scope.venues[0],$scope.isloggedin=function(){return $scope.username=storageService.getUsername(),authService.isloggedin()},$rootScope.$on("loginTosignin",function(){$scope.signin()}),$rootScope.$on("signinTologin",function(){$scope.login()}),$scope.signin=function(){$mdDialog.show({templateUrl:"component/directive/signup.dir.html",parent:angular.element(document.body),controller:function($rootScope,$scope,$http,Toaster){$state.go("landingpage.register"),$scope.signup=function(){""==$scope.user.firstname||""==$scope.user.lastname||""==$scope.user.email||""==$scope.user.password||""==$scope.user.confirmpassword?Toaster.warning("Enter Details!!!!!"):$scope.user.password===$scope.user.confirmpassword?$http.post("/newuser",$scope.user).then(function(res){0==res.data.success&&1==res.data.exist?Toaster.warning("User already Registered!!!!!"):(console.log(res),$scope.user="",$mdDialog.hide(),Toaster.success("Signed In Successfully"),$state.go("landingpage"))}):(Toaster.warning("Password mismatch"),console.log("password wrong"),$scope.user.password="",$scope.user.confirmpassword="")},$scope.closeModal=function(){$mdDialog.hide(),$state.go("landingpage")},$scope.login=function(){$rootScope.$emit("signinTologin"),$mdDialog.hide(),$state.go("landingpage.login")}},targetEvent:event,clickOutsideToClose:!0,fullscreen:$scope.fullscreen})},$scope.login=function(){$mdDialog.show({templateUrl:"component/directive/login.dir.html",parent:angular.element(document.body),controller:function($rootScope,$scope,$http,$state,$mdDialog,$window,authToken,storageService,Toaster){$state.go("landingpage.login"),$scope.login=function(){console.log($scope.userlogin),""==$scope.userlogin.email||""==$scope.userlogin.password?(Toaster.warning("Enter Details!!!!"),document.getElementById("label").style.color="red"):$http.post("/login",$scope.userlogin).then(function(res){!1===res.data.success&&!1===res.data.exist?(console.log(res.data.exist),Toaster.warning("No user Found")):!0===res.data.success&&!0===res.data.exist?(authToken.setitem(res.data.token),storageService.save("loggedin",!0),storageService.setUsername(res.data.user[0].users.userdetail.firstname),$mdDialog.hide(),Toaster.success("LoggedIn"),$state.go("landingpage"),$scope.userlogin="",console.log(res)):Toaster.warning("Incorrect Password")})},$scope.closeModal=function(){$mdDialog.hide(),$state.go("landingpage")},$scope.signup=function(){$rootScope.$emit("loginTosignin"),$mdDialog.hide(),$state.go("landingpage.register")}},targetEvent:event,clickOutsideToClose:!0,fullscreen:$scope.fullscreen})},$scope.logout=function(){storageService.remove("loggedin"),authToken.removeitem(),Toaster.warning("Logged Out")}}]).directive("emptyInput",function($parse){return{require:"?ngModel",link:function(scope,element,attrs,ngModel){!angular.isObject(ngModel)||attrs.type&&"text"!==attrs.type||$parse(attrs.ngModel).assign(scope,"")}}}),angular.module("playven").factory("dataFactory",["$http","$q",function($http,$q){var updatedata,getdata,querydata,datafactory={};return datafactory.sampleF=function(offset,limit){var def=$q.defer();return getdata?(updatedata=getdata.cards.slice(offset,limit),def.resolve(updatedata)):$http.get("/carddetail").then(function(res){return null===offset&&null===limit?(getdata=res.data[0],def.resolve(getdata)):(getdata=res.data[0],updatedata=getdata.cards.slice(offset,limit),def.resolve(updatedata))}),def.promise},datafactory.newvalue=function(gameParam,venueParam){var def=$q.defer();return $http.get("/querydata",{params:{venue:venueParam,game:gameParam}}).then(function(res){return querydata=res.data[0].cards,def.resolve(querydata)}),def.promise},{getvalue:function(offset,limit){return datafactory.sampleF(offset,limit)},querydata:function(gameParam,venueParam){return datafactory.newvalue(gameParam,venueParam)}}}]),angular.module("playven").controller("landingpageCtrl",["$scope","dataFactory","$state","$mdDialog","$location","$window","$element",function($scope,dataFactory,$state,$mdDialog,$location,$element){dataFactory.getvalue(null,null).then(function(res){$scope.flexs=res});var parallax=$(".player-parallax");parallax.length;$(window).on("scroll",function(){window.requestAnimationFrame(function(){var parallaxNew=parallax,scrolled=$(window).scrollTop();parallaxNew.css({transform:"translate3d(0,"+.22*scrolled+"px,0)"})})});var RightballParallax=$(".ball-right-parallax");$(window).on("scroll",function(){window.requestAnimationFrame(function(){var ballParallaxNew=RightballParallax,scrolle=$(window).scrollTop();ballParallaxNew.css({transform:"translate3d(0,"+.3*scrolle+"px,0)"})})});var leftballParallax=$(".ball-left-parallax");$(window).on("scroll",function(){window.requestAnimationFrame(function(){var ballParallaxNew=leftballParallax,scrolle=$(window).scrollTop();ballParallaxNew.css({transform:"translate3d(0,"+.22*scrolle+"px,0)"})})}),$scope.rightarrow=function(){var carousel=angular.element(document.getElementById("card_flex_main")),style=window.getComputedStyle(carousel.get(0)),matrixval=new WebKitCSSMatrix(style.transform).m41-272;carousel.css({transform:"translate3d("+matrixval+"px,0,0)",transition:"transform 0.4s"})},$scope.leftarrow=function(){var carousel=angular.element(document.getElementById("card_flex_main")),style=window.getComputedStyle(carousel.get(0)),matrixval=new WebKitCSSMatrix(style.transform).m41+272;carousel.css({transform:"translate3d("+matrixval+"px,0,0)",transition:"transform 0.4s"})}}]),angular.module("playven").controller("profileCtrl",["$scope","Toaster","$http","authToken",function($scope,Toaster,$http,authToken){$scope.profileEdit=!0,$scope.indexs=1,$scope.update={firstname:""},$http.get("/userinfo").then(function(res){$scope.update=res.data.decode[0].users.userdetail,console.log($scope.update)}),$scope.edit=function(index){$scope.indexs=1,$scope.profileEdit=!0,$scope.myactivity=!1,$scope.mygamepasses=!1,$scope.myemail=!1,$scope.myinvoice=!1},$scope.activity=function(){$scope.indexs=2,$scope.myactivity=!0,$scope.profileEdit=!1,$scope.mygamepasses=!1,$scope.myemail=!1,$scope.myinvoice=!1},$scope.gamepasses=function(){$scope.indexs=3,$scope.mygamepasses=!0,$scope.profileEdit=!1,$scope.myactivity=!1,$scope.myemail=!1,$scope.myinvoice=!1},$scope.email=function(){$scope.indexs=4,$scope.myemail=!0,$scope.profileEdit=!1,$scope.myactivity=!1,$scope.mygamepasses=!1,$scope.myinvoice=!1},$scope.invoice=function(){$scope.indexs=5,$scope.myinvoice=!0,$scope.profileEdit=!1,$scope.myactivity=!1,$scope.mygamepasses=!1,$scope.myemail=!1},$scope.activetabs=function(index){return $scope.indexs===index?"tabs-is-opened":""},$scope.saveChange=function(update){""==update.firstname&&""==update.lastname&&""==update.email&&""==update.phone&&""==update.city&&""==update.address&&""==update.oldpwd&&""==update.newpwd&&""==update.newconfirmpwd?Toaster.warning("Enter something!!!!"):update.oldpwd&&update.newpwd&&update.newconfirmpwd?update.newpwd===update.newconfirmpwd?(Toaster.success("password match"),$http.post("/update",update).then(function(res){console.log(res),Toaster.success("password update success"),authToken.setitem(res.data.token)})):Toaster.warning("password mismatch!!"):""==update.oldpwd&&""==update.newpwd&&""==update.newconfirmpwd?$http.post("/update",update).then(function(res){console.log(res),Toaster.success("no password update success")}):Toaster.warning("Wrong!!")}}]),angular.module("playven").controller("venueCtrl",["$scope","$http","querydata","dataFactory","$stateParams","$state","$location","$timeout",function($scope,$http,querydata,dataFactory,$stateParams,$state,$location,$timeout){$stateParams.game,$stateParams.venue,$stateParams.time,$stateParams.hour;$scope.currentPage=0,$scope.itemperpage=9;$location.search();$scope.$watch("currentPage",function(newvalue,oldvalue){$timeout(function(){var offset=newvalue*$scope.itemperpage;$scope.flexs=querydata.slice(offset,offset+$scope.itemperpage)})});var page=querydata.length;$scope.pageSize=[];var count=null;$scope.pagelimit=Math.ceil(page/$scope.itemperpage);for(var i=1;i<=$scope.pagelimit;i++)count++,$scope.pageSize.push(count);$scope.pageActive=function(index){return $scope.currentPage===index?"pagination-active-no":""},$scope.nextPage=function(){$scope.currentPage++},$scope.previousPage=function(){$scope.currentPage--},$scope.prevPageDisabled=function(){return 0===$scope.currentPage?"disabled":""},$scope.currPageDisabled=function(){return $scope.currentPage===$scope.pagelimit?"disabled":""}}]).filter("offset",function(){return function(input,start){return start=parseInt(start,10),input.slice(start)}}),angular.module("playven").directive("venueSearch",function(){return{restrict:"EA",templateUrl:"component/directive/venuesearch.html",controller:function($scope,$state,$http,$stateParams,dataFactory,$mdDialog,$location,$stateParams,$element){$scope.games=["tennis","soccer","badminton","volleyball","football"],$scope.venues=["jolarpet","tirupattur","vaniyambadi","ambur"],$scope.timings=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00"],$scope.hours=["30 min","60 min","1 hours","2 hours","3 hours"],$scope.gameOpen=null,$scope.venueOpen=null,$scope.timeOpen=null,$scope.hourOpen=null,$scope.gameActive=$scope.games[0],$scope.venueActive=$scope.venues[0],$scope.timeActive=$scope.timings[0],$scope.hourActive=$scope.hours[0];$stateParams.game,$stateParams.venue,$stateParams.time,$stateParams.hour;$scope.gamefun=function(){var toggle=$(event.target).closest(".select-line-outer").find("#select-line-inner");0==$scope.gameOpen?($scope.gameOpen=!0,toggle.addClass("is-open"),toggle.removeClass("is-closed")):($scope.gameOpen=!1,toggle.removeClass("is-open"),toggle.addClass("is-closed"))},$scope.catogoryFunc=function(index){$scope.gameActive=$scope.games[index],$scope.gamefun()},$scope.venuefun=function(){var toggle=$(event.target).closest(".select-line-outer").find("#select-line-inner");0==$scope.venueOpen?($scope.venueOpen=!0,toggle.addClass("is-open"),toggle.removeClass("is-closed")):($scope.venueOpen=!1,toggle.removeClass("is-open"),toggle.addClass("is-closed"))},$scope.venueSelec=function(index){$scope.venueActive=$scope.venues[index],$scope.venuefun()},$scope.timefun=function(){var toggle=$(event.target).closest(".select-line-outer").find("#select-line-inner");0==$scope.timeOpen?($scope.timeOpen=!0,toggle.addClass("is-open"),toggle.removeClass("is-closed")):($scope.timeOpen=!1,toggle.removeClass("is-open"),toggle.addClass("is-closed"))},$scope.timeSelec=function(index){$scope.timeActive=$scope.timings[index],$scope.timefun()},$scope.hourfun=function(){0==$scope.hourOpen?$scope.hourOpen=!0:$scope.hourOpen=!1},$scope.hourSelec=function(index){$scope.hours[index]&&($scope.hourActive=$scope.hours[index]),$scope.hourfun()},$scope.findvenue=function(){var gameval=angular.element(document.getElementsByName("gameValue")).val(),venueval=angular.element(document.getElementsByName("venueValue")).val(),timeval=angular.element(document.getElementsByName("timeValue")).val(),hourval=angular.element(document.getElementsByName("hourValue")).val();$state.go("venue",{game:gameval,venue:venueval,time:timeval,hour:hourval,page:1})}}}}),angular.module("playven").factory("authToken",["$window",function($window){var authToken="auth-token";return{getitem:function(){return $window.localStorage.getItem(authToken)},setitem:function(token){token&&$window.localStorage.setItem(authToken,token)},removeitem:function(){$window.localStorage.removeItem(authToken)}}}]).factory("authInterceptor",["authToken",function(authToken){return{request:function(config){var token=authToken.getitem();return token&&(config.headers=config.headers||{},config.headers.Authorization=token),config},response:function(config){var token=authToken.getitem();return token&&(config.headers=config.headers||{},config.headers.Authorization=token),config}}}]),angular.module("playven").service("authService",["$window",function($window){this.isloggedin=function(){return!!$window.localStorage.getItem("loggedin")}}]).service("storageService",["$window",function($window){var localStorage=$window.localStorage;this.save=function(key,value){return console.log("save"),localStorage.setItem(key,value)},this.setUsername=function(value){return localStorage.setItem("username",value)},this.getUsername=function(key){return localStorage.getItem("username")},this.remove=function(key){return localStorage.removeItem(key)}}]).service("Toaster",["$mdToast",function($mdToast){this.warning=function(content){$mdToast.show($mdToast.simple().textContent(content).position("top right").hideDelay(1e3).theme("warning-theme"))},this.success=function(content){$mdToast.show($mdToast.simple().textContent(content).position("top right").hideDelay(1e3).theme("success-theme"))}}]);